@using MediaPlus.Services
@model UserSessionModel

@if (Model != null)
{
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userProfileDropdown" role="button"
           data-bs-toggle="dropdown" aria-expanded="false">
            <div class="user-avatar me-2">
                <div class="avatar-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                     style="width: 40px; height: 40px;">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            <div class="user-info d-none d-lg-block">
                <div class="user-name fw-bold text-dark">@Model.UserLoginName</div>
                <div class="user-role text-muted small">@Model.RoleName</div>
            </div>
        </a>
        <ul class="dropdown-menu dropdown-menu-end user-profile-dropdown" aria-labelledby="userProfileDropdown">
            <li class="dropdown-header text-center py-3">
                <div class="avatar-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2"
                     style="width: 50px; height: 50px;">
                    <i class="fas fa-user fa-lg"></i>
                </div>
                <h6 class="mb-1 fw-bold">@Model.UserLoginName</h6>
                <small class="text-muted">@Model.RoleName</small>
            </li>
            <li><hr class="dropdown-divider"></li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="viewProfile()">
                    <i class="fas fa-user-circle me-3 text-primary"></i>
                    <span>@Localizer["My Profile"]</span>
                </a>
            </li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="editProfile()">
                    <i class="fas fa-edit me-3 text-info"></i>
                    <span>@Localizer["Edit Profile"]</span>
                </a>
            </li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="changePassword()">
                    <i class="fas fa-key me-3 text-warning"></i>
                    <span>@Localizer["Change Password"]</span>
                </a>
            </li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2" asp-controller="Dashboard" asp-action="SetLanguage">
                    <i class="fas fa-language me-3 text-success"></i>
                    <span>@Localizer["Language Settings"]</span>
                </a>
            </li>
            
            <li><hr class="dropdown-divider"></li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2" href="#" onclick="showHelp()">
                    <i class="fas fa-question-circle me-3 text-secondary"></i>
                    <span>@Localizer["Help & Support"]</span>
                </a>
            </li>
            
            <li><hr class="dropdown-divider"></li>
            
            <li>
                <a class="dropdown-item d-flex align-items-center py-2 text-danger" asp-controller="Account" asp-action="Logout">
                    <i class="fas fa-sign-out-alt me-3"></i>
                    <span>@Localizer["Logout"]</span>
                </a>
            </li>
        </ul>
    </li>
}
else
{
    <li class="nav-item">
        <a class="nav-link btn btn-primary text-white px-4" asp-controller="Account" asp-action="Login">
            <i class="fas fa-sign-in-alt me-2"></i>
            @Localizer["Login"]
        </a>
    </li>
}

<style>
    .user-profile-dropdown {
        border-radius: 15px;
        border: none;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        padding: 0;
        min-width: 280px;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
    }

    .user-profile-dropdown .dropdown-header {
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-bottom: 1px solid #e2e8f0;
    }

    .user-profile-dropdown .dropdown-item {
        padding: 0.75rem 1.5rem;
        transition: all 0.3s ease;
        border-radius: 8px;
        margin: 0.25rem 0.5rem;
    }

    .user-profile-dropdown .dropdown-item:hover {
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        transform: translateX(5px);
    }

    .user-profile-dropdown .dropdown-item.text-danger:hover {
        background: linear-gradient(135deg, #fef2f2, #fee2e2);
        color: #dc2626 !important;
    }

    .avatar-circle {
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(37, 99, 235, 0.2);
    }

    .avatar-circle:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
    }

    .user-info {
        line-height: 1.2;
    }

    .user-name {
        font-size: 0.9rem;
    }

    .user-role {
        font-size: 0.75rem;
    }

    /* Animation for dropdown items */
    .user-profile-dropdown .dropdown-item {
        opacity: 0;
        animation: fadeInUp 0.3s ease forwards;
    }

    .user-profile-dropdown .dropdown-item:nth-child(1) { animation-delay: 0.1s; }
    .user-profile-dropdown .dropdown-item:nth-child(2) { animation-delay: 0.2s; }
    .user-profile-dropdown .dropdown-item:nth-child(3) { animation-delay: 0.3s; }
    .user-profile-dropdown .dropdown-item:nth-child(4) { animation-delay: 0.4s; }
    .user-profile-dropdown .dropdown-item:nth-child(5) { animation-delay: 0.5s; }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* RTL Support */
    [dir="rtl"] .user-profile-dropdown .dropdown-item:hover {
        transform: translateX(-5px);
    }
</style>

<script>
    function viewProfile() {
        // Implementation for viewing profile
        showNotification('@Localizer["Profile view functionality"]', 'info');
    }

    function editProfile() {
        // Implementation for editing profile
        showNotification('@Localizer["Edit profile functionality"]', 'info');
    }

    function changePassword() {
        // Implementation for changing password
        showNotification('@Localizer["Change password functionality"]', 'info');
    }

    function showHelp() {
        // Implementation for help
        showNotification('@Localizer["Help documentation coming soon"]', 'info');
    }

    $(document).ready(function() {
        // Add online status indicator
        $('.avatar-circle').append('<span class="online-indicator"></span>');
    });
</script>

<style>
    .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        background: #10b981;
        border: 2px solid white;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }
</style>
